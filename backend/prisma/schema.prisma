// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Application {
  id       Int                   @id @default(autoincrement())
  name     String                @unique
  versions Application_Version[]
}

model Application_Version {
  id                    Int               @id @default(autoincrement())
  name                  String
  application           Application       @relation(fields: [applicationId], references: [id], onDelete: Cascade)
  applicationId         Int
  urls                  Application_URL[]
  cookieTemplates       CookieTemplate[]
  unknowCookieInstances CookieInstance[]
  unknowURLInstances    URLInstance[]
  enable                Boolean           @default(true)

  @@unique([name, applicationId])
}

enum Application_URL_Type {
  PREFIX
  EXACT
}

model Application_URL {
  id                   Int                 @id @default(autoincrement())
  url                  String              @unique
  type                 Application_URL_Type
  applicationVersion   Application_Version @relation(fields: [applicationVersionId], references: [id], onDelete: Cascade)
  applicationVersionId Int
}

model CookieTemplate {
  id                   Int                 @id @default(autoincrement())
  nameRegex            String              
  domain               String?
  path                 String?
  httpOnly             Boolean?
  hostOnly             Boolean?
  secure               Boolean?
  session              Boolean?
  applicationVersion   Application_Version @relation(fields: [applicationVersionId], references: [id], onDelete: Cascade)
  applicationVersionId Int
  @@unique([nameRegex, domain, applicationVersionId])

}

model CookieInstance {
  id                   Int                 @id @default(autoincrement())
  name                 String
  domain               String
  path                 String
  httpOnly             Boolean
  hostOnly             Boolean
  secure               Boolean
  session              Boolean
  timestamp            Int
  duration             Float?
  url                  String
  applicationVersion   Application_Version @relation(fields: [applicationVersionId], references: [id], onDelete: Cascade)
  applicationVersionId Int
  @@unique([name, domain, applicationVersionId])

}

model URLInstance {
  id                   Int                 @id @default(autoincrement())
  url                  String
  applicationVersion   Application_Version @relation(fields: [applicationVersionId], references: [id], onDelete: Cascade)
  applicationVersionId Int
  @@unique([url, applicationVersionId])
}
